<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<div th:fragment="taskTemplate" th:id="'task_' + ${task.getId()}" class="task card card-body">
    <div id="delete-task_button" th:if="${myRole == ROLE_MANAGER}" class="mt-2">
        <button type="button" class="btn close" data-toggle="modal" data-target="#deleteConfirmation" th:attr="data-task-id=${task.getId()}" aria-label="Close" title="Удалить">
            <img src="close.svg" onerror="this.src='close.png'">
        </button>
    </div>
    <div th:id="'task_creator_' + ${task.getId()}" class="task_creator_and_performer">
        <span class="task_title">Создатель</span>
        <span class="task_content" th:text="${task.creator.fullname}">ФИО создателя таска</span>
    </div>
    <div th:id="'task_performer_' + ${task.getId()}" class="task_creator_and_performer">
        <span class="task_title">Исполнитель</span>
        <span class="task_content" th:text="${task.performer.fullname}">ФИО исполнителя таска</span>
    </div>
    <div th:id="'task_description_' + ${task.getId()}" class="task_field">
        <div class="task_title">Задача</div>
        <div class="task_content" th:text="${task.description}">Прочитать 1000 книг.</div>
    </div>
    <div th:id="'task_result_' + ${task.getId()}" class="task_field">
        <div class="task_title">Ожидаемый результат</div>
        <div class="task_content" th:text="${task.expectedResult}">Прочтено 1000 книг к установленной дате.</div>
    </div>
    <div class="d-flex">
        <div th:id="'task_exp_due_date_' + ${task.getId()}" class="task_field">
            <div class="task_title">Ожидаемая дата выполнения</div>
            <div class="t ask_content" th:text="${task.expectedDueDate}">31-02-2021</div>
        </div>
        <div th:id="'task_act_due_date_' + ${task.getId()}" class="task_field">
            <div class="task_title">Выполнено</div>
            <div class="task_content" th:text="${task.getActualDueDate() != null} ? ${task.getActualDueDate()} : 'не выполнено'">не выполнено</div>
        </div>
    </div>
    <div th:id="'task_task_progress_' + ${task.getId()}" class="task_field">
        <span class="task_title">Прогресс: </span>
        <span th:id="'task_progress_value_' + ${task.getId()}" class="task_content" th:text="${task.progress} + '%'">10%</span>
        <div class="progress">
            <span th:id="'task_progress_bar_' + ${task.getId()}" class="progress-bar" th:classappend="${task.progress==100} ? bg-success : bg-warning" role="progressbar" style="width: 50%;" th:style="'width: ' + ${task.progress} + '%;'"></span>
        </div>
    </div>
    <div th:id="'task_reports_' + ${task.getId()}" class="task_field">
        <button
                class="btn btn-warning"
                type="button"
                data-toggle="collapse"
                aria-expanded="false"
                th:attr="data-target='#task_reports_content_'+${task.getId()}"
                th:attrappend="aria-controls='task_reports_content_'+${task.getId()}">
            Отчеты
        </button>

        <div th:id="'task_reports_content_' + ${task.getId()}" class="collapse gap-3">

            <div th:each="report: ${task.reports}" th:id="'task_reports_content_' + ${task.getId()} + '_' + ${report.getId()}" class="card card-body mt-2">
                <small class="text-muted" th:text="${report.getCreationDate()}">creationDate</small>
                <div th:text="${report.getProgress()} + '%'">progress</div>
                <div th:text="${report.getComment()}">comment</div>
            </div>

            <br>

            <div th:if="${task.getPerformer().getId() == me.getId()}" class="p-3">
                <div class="mb-3">
                    <label th:for="'add-report_progress_' + ${task.getId()}" class="col-form-label">Прогресс</label>
                    <input type="number" th:id="'add-report_progress_' + ${task.getId()}" class="form-control col-sm-10"  min="0" max="100">
                </div>
                <div class="mb-3">
                    <label th:for="'add-report_comment_' + ${task.getId()}">Комментарий</label>
                    <textarea class="form-control" th:id="'add-report_comment_' + ${task.getId()}" rows="3"></textarea>
                </div>
                <button th:onclick="|addReport(${task.getId()})|" type="button" class="btn btn-success">Добавить отчёт</button>
            </div>

        </div>
    </div>
</div>

<div th:fragment="addTask" id="add-task" class="tasks">
    <div class="d-flex w-100">
        <div class="mb-3 w-50">
            <label for="add-task_performer" class="col-form-label">Исполнитель</label>
            <select id="add-task_performer" class="form-control">
                <option th:each="performer: ${allPerformers}" th:value="${performer.getId()}" th:text="${performer.getFullname()}">
            </select>
        </div>
        <div class="mb-3 ml-4 w-50">
            <label for="add-task_expected_due_date" class="col-form-label">Ожидаемая дата исполнения</label>
            <input type="date" class="form-control" id="add-task_expected_due_date">
        </div>
    </div>
    <div class="d-flex w-100">
        <div class="mb-3 w-50">
            <label for="add-task_description" class="col-form-label">Описание</label>
            <textarea class="form-control" id="add-task_description" rows="7"></textarea>
        </div>
        <div class="mb-3 ml-4 w-50">
            <label for="add-task_expected_result" class="col-form-label">Ожидаемый результат</label>
            <textarea class="form-control" id="add-task_expected_result" rows="7"></textarea>
        </div>
    </div>
    <button th:onclick="|addTask(${me.getId()});|" type="button" class="btn btn-success">Добавить задачу</button>
</div>